NAT（Network Address Translation）网络地址转换，即在私有地址和全局地址之间转换的协议。私有地址是不能用在 Internet 上(路由器将丢弃寻址这种地址的包)的内部地址。这些地址是不能够在公网上面用的，只能用在局域网的内部。私有地址有三种：①`10.0.0.0~10.255.255.255/8`；② `172.16.0.0~172.31.255.255/12`； ③ `192.168.0.0~192.168.255.255/16`。这些 IP 地址是用于私有的网络，与之对应的是全局地址，就是正规的自己电脑的地址，全网络承认。

NAT 协议的工作过程如下所示：

<img src ="https://img-blog.csdnimg.cn/4f63555f2c5c48e8bdcd546c1188bc70.png#pic_center" width = 64%>


假设一个私有地址为 `10.1.0.2` 的主机想访问互联网服务器 `162.105.192.12`，那么首先它首先把消息发出给 NAT 路由器。路由器记录了它的内网地址和端口，并且给它分配一个全局地址和全局端口。这个地址关系记录在 NAT 路由表中。之后按照目的地址发给服务器。一段时间之后，服务器回应了请求给 NAT 路由器，那么路由器根据目的地址和端口（此时是全局的）按照 NAT 路由表转换为对应的主机地址，再发送给主机，这样主机就收到了服务器的回应。

从上面的过程就能看到 NAT 路由器的作用：针对出境包源地址进行替换；在 NAT 转换表中记录映射关系；针对入境包目标地址进行替换。

NAT 的路由表如下所示：

<img src ="https://img-blog.csdnimg.cn/21a4c78d7e7d4cca891640a5f87df747.png#pic_center" width = 64%>


**功能**

NAT 不仅能解决 IP 地址不足的问题，而且还能够有效地避免来自网络外部的攻击，隐藏并保护网络内部的计算机。作用是把内网的私有地址，转化成外网的公有地址。使得内部网络上的（被设置为私有 IP 地址的）主机可以访问 Internet。
1. 宽带分享：这是 NAT 主机的最大功能。
2. 安全防护：NAT 之内的 PC 联机到 Internet 上面时，他所显示的 IP 是 NAT 主机的公共 IP，所以 Client 端的 PC 当然就具有一定程度的安全了，外界在进行 portscan（端口扫描） 的时候，就侦测不到源 Client 端的 PC 。

**实现方式**

NAT 的实现方式有三种，即静态转换 Static Nat、动态转换 Dynamic Nat 和端口多路复用 OverLoad。
1. 静态转换是指将内部网络的私有 IP 地址转换为公有 IP 地址，IP地址对是一对一的，是一成不变的，某个私有IP地址只转换为某个公有IP地址。借助于静态转换，可以实现外部网络对内部网络中某些特定设备（如服务器）的访问。
2. 动态转换是指将内部网络的私有 IP 地址转换为公用 IP 地址时，IP 地址是不确定的，是随机的，所有被授权访问上 Internet 的私有 IP 地址可随机转换为任何指定的合法 IP 地址。也就是说，只要指定哪些内部地址可以进行转换，以及用哪些合法地址作为外部地址时，就可以进行动态转换。动态转换可以使用多个合法外部地址集。当 ISP 提供的合法 IP 地址略少于网络内部的计算机数量时。可以采用动态转换的方式。
3. 端口多路复用是指改变外出数据包的源端口并进行端口转换，即端口地址转换(PAT, Port Address Translation)。采用端口多路复用方式。内部网络的所有主机均可共享一个合法外部 IP 地址实现对 Internet 的访问，从而可以最大限度地节约 IP 地址资源。同时，又可隐藏网络内部的所有主机，有效避免来自 Internet 的攻击。因此，目前网络中应用最多的就是端口多路复用方式。































