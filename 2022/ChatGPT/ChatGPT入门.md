## 1 ChatGPT 注册

受限于ChatGPT的服务器以及相关要求影响，其注册比较繁琐，在国内是无法使用的，而我们又想体验一下ChatGPT，具体ChatGPT怎么注册呢？

我综合了网络上的各种注册教程，整理了这篇文章。主要供大家学习和使用。

### 1.1 工具准备

注册/登录环境要求：
- 注册和登陆需要国外环境。
- 需要有一个可以接收验证码的国外手机号，同样地区也是如上述网络环境之外的地区手机号（注意部分虚拟手机号的厂家无法接受验证码，请注意甄别）。

**1. 注册工具准备**

在注册ChatGPT之前，需要准备好以下几个工具：
1. 一个邮箱（我们用的Gmail邮箱，经测试其他邮箱也可以）
2. 科学上网工具（自行百度，或者私信我）
3. 一个国外手机号（后文将详细告诉你如何花少许人民币获取一个临时国外手机号）

在以上三个工具中，可能大部分人前两个工具已经有了。但很多人没有国外手机号。下面我们一起来看一下如何快速，低费用获取一个能接收ChatGPT验证短信的国外手机号。

**2. 购买一个临时国外手机号**

首先，登录一个国外临时手机号购买网站：[https://sms-activate.org/](https://sms-activate.org/)

1) 进入 [SMS-Activate是在线接收短信的虚拟号码服务平台](https://sms-activate.org/) 的首页，选择右上角【注册】按钮，在弹出的窗口中继续选择【注册】按钮：

<img src ="https://img-blog.csdnimg.cn/9314d1aaeed547de8c88853798c1a9e3.png#pic_center" width = 49%>

2) 输入邮箱、设置密码完成账号注册,（不建议用国内的邮箱，避免收不到问题，最好是Gmail之类的），密码长度在8位以上且必须包含拉丁字母和数字，至少一个大写字母。登录你的邮箱，然后你会收到一封标题为《确认电子邮件来注册SMS-Activate账户》这样的邮件，点击邮件中的【确认】按钮，注册成功后，在账号中，点击右上角的充值。提示：如果收件箱找不到，看一下垃圾箱或者黑名单/规则之类是不是过滤掉了。如果实在没有，建议换一个邮箱试试。

<img src ="https://img-blog.csdnimg.cn/ab1e28edc23d47bbb3e60ea78b1c2bad.png#pic_center" width = 49%>

3) 确认帐号注册成功后，登录平台，不过帐号还需要充值才能使用，可以使用支付宝充值。还是右上角，选择【余额】，然后选择【充值】按钮，接着选择支付宝进行充值，这里现在要求至少充值2美元，输入2，点击最下角的支付，然后进入支付宝扫码付款页面，扫码支付即可，自动汇率换算支付人民币14.93元（你注册时可能由于汇率不同金额会有差异）。

<img src ="https://img-blog.csdnimg.cn/d9760b3c5d7c462a8b5a73b445954af3.png#pic_center" width = 49%>


<img src ="https://img-blog.csdnimg.cn/b1f86b7890e04b12be004ceb4f9a930c.jpeg#pic_center" width = 48%>

4) 充值完成后，注意看个人页面右上角的余额有没有变化。然后看左侧，找到“openAI”这个，点击展开（如果没有，在选择服务-服务搜索里直接搜索一下）：

<img src ="https://img-blog.csdnimg.cn/f1cac92dc3464c9c8ee4fc224506aa9e.png#pic_center" width = 48%>


5) 接着，选择手机号码的归属地，哪个便宜买哪个。选好后直接点击对应国家后面的购物车图片即可：

<img src ="https://img-blog.csdnimg.cn/2fdc138cf1464cc9ad454d45b263b9d2.png#pic_center" width = 48%>

6) 购买后，账号页面右侧，可以看到你购买的手机号，然后返回到ChatGPT的页面，填入对应的手机号码，页面会自动显示出收到的短信。

<img src ="https://img-blog.csdnimg.cn/e59615c60f594effbef9be62f282ec2c.png#pic_center" width = 48%>

关于这个国外手机号说四点：
- 这里显示的号码是包含国家代码的。比如美国手机号+254771961634，你在网站上填写手机号时，需要去掉前面的 254 这个国别代码。另外在接收验证码时，建议使用低价的印尼等手机号，印度经常挤爆收不到；如果长时间没有收到验证码，可更换成其他区域尝试。
- 这是一个临时手机号，有效时长20分钟
- 20分钟内如果没有收到验证码，可以点右侧的叉号，退订，费用还会返还。（注：一般在ChatGPT注册页面发出验证码后一分钟左右便可以收到验证码。收不到验证短信可以在20分钟到期前退订，三分钟以上收不到验证码建议就不用再等了）
- 如遇到无法登录的情况，请打开谷歌浏览器的无痕窗口进行登录，一般会很快登录账号。


另外保留这个显示国外手机号的页面处于打开状态即可，便于快速回来查收验证短信。重点是：在手机验证页面，一定要注意选择正确的国家（注意国旗）！一定要注意选择正确的国家！一定要注意选择正确的国家！

### 1.2 注册流程

**1. 进入注册**
打开ChatGPT的官方网站，链接为 [https://openai.com/](https://openai.com/)，然后点击【Sign Up】进入下一步。

如果页面无法正常显示，需要更换其他的网络节点，或者清理下浏览器cookie再次尝试。

<img src ="https://img-blog.csdnimg.cn/a76aa02fee3940b38eda3951ae58f6db.png#pic_center" width = 49%>

**2. 邮箱注册**

注册方式为邮箱注册，可以用微软帐号或者谷歌帐号登录，微软账号或者谷歌账号好像不需要验证，国内或者其他邮箱地址都需要进行验证（比如QQ邮箱是需要验证的）。

<img src ="https://img-blog.csdnimg.cn/2357460dc1e04bf9bf0e1f17cd19aed2.png#pic_center" width = 48%>

3. 填写姓名信息
邮箱通过后，会提示你输入姓名，按照要求进行输入即可。如果显示该IP地址注册数量过多，则需要更换节点（更换节点时，无需对浏览器进行重启，刷新页面即可）。


**4. 验证手机号（重点！！！）**
随后将会进入手机验证的环节，记住：这里不能选择国内的手机号，国内的手机号无法进行注册。

如果是只想体验一下产品的朋友，可直接在某海鲜市场购买服务，实时帮你接收验证码，非常快速。动手能力强一些的朋友，可以通过虚拟接码平台进行接收验证码。

选择手机号国别，并输入第二步中购买的手机号码，点击发送验证短信（send code）：（例如，我们买的是手机号，则选择Kenya，后面输入手机号时注意国家区号不要重复输入）

然后返回到第二步中购买手机号的页面，查收短信：(一般一分钟左右可以收到短信)

### 1.3 申请 API

OpenAI账号注册完成后，登录界面如下所示。点击右上角View API keys—> Create new secret key，可以生成属于你自己的API，有了这个API，就可以用于开发基于ChatGPT API的应用程序。

<img src ="https://img-blog.csdnimg.cn/afd248dd62c54444b7a424f4c80d3461.png#pic_center" width = 48%>

<img src ="https://img-blog.csdnimg.cn/c0e9e88f7c2c444996e9e1960abec0cc.png#pic_center" width = 48%>

需要注意的是，出于安全原因，这个API只展示一次，请务必在关闭对话框之前，将其复制到你其他的地方保管。

另外，点击左侧栏的Usage ,可以方便清晰看到token的使用量情况，数据5分钟更新一次。OpenAI官方针对每一个新注册的账户，提供$5免费token使用额度。这样一想，前面花费不到$5免费token使用额度。不过需要注意的是，免费额度有时间限制，过期了额度就作废。

<img src ="https://img-blog.csdnimg.cn/2fe1565ef7654584bd263ab450e7c0e5.png#pic_center" width = 48%>

## 2 API 使用
### 2.1 简单测试
使用 Python 简单测试，你只需 `import openai` 包，带上刚申请的API，模型选择————— `text-davinci-003` 就可以。

```python
import openai
 
openai.api_key = 'sk-xxxxxx'        # 填写个人API
def chat_gpt(prompt):
     prompt = prompt
     model_engine = "text-davinci-003"
     completion = openai.Completion.create(
         engine=model_engine,
         prompt=prompt,
         max_tokens=1024,
         n=1,
         stop=None,
         temperature=0.5,
         timeout=1000,
     )
 
     response = completion.choices[0].text
     print(response)
 
chat_gpt("现在几点了")          # 现在是北京时间下午4点30分。
```

<p>更多的例子，请自行参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Fblog%2Fintroducing-chatgpt-and-whisper-apis" target="_blank" title="https://openai.com/blog/introducing-chatgpt-and-whisper-apis" ref="nofollow noopener noreferrer">官方例子</a>以及<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2Fapi-reference%2Fintroduction" target="_blank" title="https://platform.openai.com/docs/api-reference/introduction" ref="nofollow noopener noreferrer">官方API文档</a>。</p>

### 2.2 设置代理

有的同学可能会遇到以下问题，这里综合了网上的解决办法。

> 返回错误信息：
> raise error.APIConnectionError(openai.error.APIConnectionError: Error communicating with OpenAI: HTTPSConnectionPool(host='api.openai.com', port=443): Max retries exceeded with url: /v1/chat/completions (Caused by SSLError(SSLEOFError(8, 'EOF occurred in violation of protocol (_ssl.c:1131)')))


**1. urllib3 降低版本到 1.25.11**

```python
pip install urllib3==1.25.11
```


参考大佬文章：[Python 遭遇 ProxyError 问题记录](https://zhuanlan.zhihu.com/p/350015032)
简单来说就是 1.26.0 版本的 urllib3 添加了 HTTPS 支持，但代理服务器不支持 HTTPS，所以报错（pip走代理报错也差不多类似原因，具体请参考上文，有详细解读）

**2. 修改openai源码（亲测成功）**

根据自己安装openai包的路径，找到并打开 `api_requestor.py`，我的路径为：`C:\***\***\.conda\envs\py3.8\lib\site-packages\openai\api_requestor.py`，找到下面的部分：`if not hasattr(_thread_context, "session"):`，并在此方法上方加入代理，如下图框的部分。

<img src ="https://img-blog.csdnimg.cn/f9b28f50515a404ba22e57ba8a9cdbab.png#pic_center" width = 48%>


添加的代码为：
代理部分：

```python
# proxy = {
#    'http': 'http://<代理ip>:<代理端口>',
#    'https': 'https://<代理ip>:<代理端口>'
#       }
 
proxy = {
    'http': 'http://localhost:7890',
    'https': 'http://localhost:7890'
}
```
端口号是你用对应软件的代理端口，我这里是7890。

在 `“result = _thread_context.session.request(”` 中加入代理
```python
result = _thread_context.session.request(
    method,
    abs_url,
    headers=headers,
    data=data,
    files=files,
    stream=stream,
    timeout=request_timeout if request_timeout else TIMEOUT_SECS,
    # proxies=_thread_context.session.proxies,      # 注释掉原本的代理
    proxies=proxy                                   # 添加自己的
)
```

参考大佬文章：[调用OpenAI的API出现Request timed out处理](https://www.cnblogs.com/ghj1976/p/diao-yongopenai-deapi-chu-xianrequest-timed-out-ch.html)


**3、代码里设置环境变量（亲测成功）**

添加以下代码：

```python
import os
 
os.environ["http_proxy"] = "http://localhost:7890"
os.environ["https_proxy"] = "http://localhost:7890"
```

## 3 ChatGPT 本地部署
### 3.1 使用魔法
**第一步，将 ChatGPT 的源代码从 Github 上下载到本地**

[https://github.com/xtekky/chatgpt-clone](https://github.com/xtekky/chatgpt-clone)

以下是命令示例：
```python
git clone https://github.com/xtekky/chatgpt-clone.git
```

这样就可以克隆代码到您的电脑上。

**第二步是安装环境**

这里选用熟悉的 Conda 安装，首先进入项目目录，然后运行以下命令来创建虚拟环境。

```python
conda create -n chatgpt-py3.9 python=3.9        # 创建虚拟环境
conda activate chatgpt-py3.9                    # 激活环境
cd ../chatgpt-clone                             # 进入项目
```
没有 Anconda 的，可以使用 Python 的 `venv` 包，首先进入项目目录，然后运行以下命令来创建虚拟环境（Linux）：

```python
cd chatgpt-clone
python -m venv venv
source venv/bin/activate            # macOS/Linux
```

如果您在使用 Windows 系统，需要使用以下的命令：

```python
venv\Scripts\activate.bat
```

**第三步：安装所需要的依赖**

使用以下命令

```python
pip install -r requirements.txt
```

**第四步：修改配置文件**

找到项目目录下的 config.josn 文件，并将文件中的 openai_key 替换成您自己的 key。

<img src ="https://img-blog.csdnimg.cn/d77787b01d4944f7ac215ee08417656c.png#pic_center" width = 48%>


**第五步：配置 magic 端口**

因为 ChatGPT 在本质上是调用 OpenAI 的接口，因此在运行该项目之前，需要让命令行工具具有 magic 能力（用魔法，前面讲过了）。

可以在命令行工具里输入以下命令（注意：您需要修改这个端口号！）

**Linux**

```python
export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890
```

**Windows**

```python
set http_proxy=http://127.0.0.1:7890
set https_proxy=http://127.0.0.1:7890

set http_proxy_user=user
set http_proxy_pass=pass

set https_proxy_user=user
set https_proxy_pass=pass
```

> 温馨提示：一定要加 http://，直接写域名或者 IP 不行。http 和 https 都要设置。然后如果想验证是否成功配置了代理的话，用 ping 命令是不可以的；ping的协议不是https，也不是https，是ICMP协议。可以使用 `curl -vv http://www.google.com`这条命令来验证。

cmd，Git Bash，PowerShell 设置的方式不同
- cmd 中用 set http_proxy 设置
- Git Bash 中用 export http_proxy 设置
- PowerShell 中按照这样设置

```python
#NOTE: registry keys for IE 8, may vary for other versions
$regPath = 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings'

function Clear-Proxy
{
    Set-ItemProperty -Path $regPath -Name ProxyEnable -Value 0
    Set-ItemProperty -Path $regPath -Name ProxyServer -Value ''
    Set-ItemProperty -Path $regPath -Name ProxyOverride -Value ''

    [Environment]::SetEnvironmentVariable('http_proxy', $null, 'User')
    [Environment]::SetEnvironmentVariable('https_proxy', $null, 'User')
}

function Set-Proxy
{
    $proxy = 'http://example.com'

    Set-ItemProperty -Path $regPath -Name ProxyEnable -Value 1
    Set-ItemProperty -Path $regPath -Name ProxyServer -Value $proxy
    Set-ItemProperty -Path $regPath -Name ProxyOverride -Value '<local>'

    [Environment]::SetEnvironmentVariable('http_proxy', $proxy, 'User')
    [Environment]::SetEnvironmentVariable('https_proxy', $proxy, 'User')
```

python 使用代理的几种方式：[https://blog.csdn.net/whatday/article/details/112169945](https://blog.csdn.net/whatday/article/details/112169945)

也可以在代码里设置环境变量

<img src ="https://img-blog.csdnimg.cn/1b1e93fcd54a41368976e0341a53d82e.png#pic_center" width = 48%>


**第六步就是运行 ChatGPT 项目并进行访问了**

你只需要在命令行输入 python run.py，然后在浏览器中访问相应的链接就好了。

<img src ="https://img-blog.csdnimg.cn/f943b7df0ae145b79b3d26e9e348ccdb.png#pic_center" width = 48%>

首先，您可以像使用普通的 GPT 一样使用暗黑版。但是，为什么他被称之为 "暗黑版" 呢？因为当您使用了暗黑模式之后，ChatGPT 将突破底线，以一种更加深入和黑暗的方式回答您的问题。以下是如何使用暗黑版的提示：

<img src ="https://img-blog.csdnimg.cn/cc492835e92b4da7aef857055cc733f3.png#pic_center" width = 48%>


### 3.2 通过免费云平台搭建代理转发


第一步，我们需要登录云平台并进入应用选择菜单。

下面是云平台官网链接：[https://cloud.sealos.io/](https://cloud.sealos.io/)

<img src ="https://img-blog.csdnimg.cn/3912f66b49f14f258a8ea1d56919b6ad.png#pic_center" width = 48%>


第二步，首次进入的用户需要新建一个应用，并进行应用的基本配置。

<img src ="https://img-blog.csdnimg.cn/5a94747476364b6f934d2f677e1b6a81.png#pic_center" width = 48%>

第三步，通过高级配置来实现代理转发。

您现在可以进入高级设置选项卡来配置代理转发功能。
- 点开高级配置
- 点击新增 configmap
- 文件名写: `/etc/nginx/nginx.conf`
- 文件值为刚刚复制的那段代码
- 点击确认

<img src ="https://img-blog.csdnimg.cn/94b43c6b6cab4557b00b15f45691108c.png#pic_center" width = 48%>

<img src ="https://img-blog.csdnimg.cn/89b7b59f110947ef91ff375552decc06.png#pic_center" width = 48%>

nginx 配置代码


```python
user nginx;
worker_processes auto;
worker_rlimit_nofile 51200;

events {
    worker_connections 1024;
}

http {
    resolver 8.8.8.8;
    proxy_ssl_server_name on;

    access_log off;
    server_names_hash_bucket_size 512;
    client_header_buffer_size 64k;
    large_client_header_buffers 4 64k;
    client_max_body_size 50M;

    proxy_connect_timeout       240s;
    proxy_read_timeout          240s;
    proxy_buffer_size 128k;
    proxy_buffers 4 256k;


    server {
        listen 80;
        server_name xxxxx.cloud.sealos.io; # 这个地方替换成 sealos 提供的内容

        location ~ /openai/(.*) {
            # auth check
          

            proxy_pass https://api.openai.com/$1$is_args$args;
            proxy_set_header Host api.openai.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            # 如果响应是流式的
            proxy_set_header Connection '';
            proxy_http_version 1.1;
            chunked_transfer_encoding off;
            proxy_buffering off;
            proxy_cache off;
            # 如果响应是一般的
            proxy_buffer_size 128k;
            proxy_buffers 4 256k;
            proxy_busy_buffers_size 256k;
        }
    }
}
```

第四步，点击部署应用按钮。

<img src ="https://img-blog.csdnimg.cn/f5f0fb3f329f40b4b2057533bd630ed6.png#pic_center" width = 48%>


第五步，如果成功，你将看到下面的结果。最后，你可以点击详情获得外部访问链接。

<img src ="https://img-blog.csdnimg.cn/fa3ad6dbf190497089f4633ff160f3b7.png#pic_center" width = 48%>


第六步，如果你正在使用暗黑版的 OpenAI GPT，并且想要更轻松地使用以上方法，那么你可以修改 `config.json` 文件中的两个参数，具体操作请看下面：
- 将 `proxy.enable` 设置为 false；
- 将 `openai_api_base` 改为在上一步获取的对外链接后加 `/openai`。


<img src ="https://img-blog.csdnimg.cn/fe275be1514c4934a4a9627a7bb0704a.png#pic_center" width = 48%>


最后，你可以通过命令运行暗黑版 GPT，就可以实现无魔法访问。好了，以上就是通过免费云平台搭建代理转发，实现对 OpenAI GPT 的免费访问的全部步骤。
______

## 参考
- ChatGPT注册教程攻略：[https://www.xnbeast.com/create-openai-chatgpt-account/](https://www.xnbeast.com/create-openai-chatgpt-account/)
- 2023年最新国内ChatGPT注册教程：[https://juejin.cn/post/7220696541309108285](https://juejin.cn/post/7220696541309108285)
- Python 遭遇 ProxyError 问题记录：[https://zhuanlan.zhihu.com/p/350015032](https://zhuanlan.zhihu.com/p/350015032)
- ChatGPT Plus官方推荐新手教程：[https://chatgpt-plus.github.io/chatgpt-plus/](https://chatgpt-plus.github.io/chatgpt-plus/)
- ChatGPT本地部署：[https://juejin.cn/post/7236668895867764773](https://juejin.cn/post/7236668895867764773)
